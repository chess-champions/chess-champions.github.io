var pe=Object.defineProperty;var qe=(e,t,r)=>t in e?pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var O=(e,t,r)=>qe(e,typeof t!="symbol"?t+"":t,r);import{r as g,u as me,e as be}from"./react-BuJ6DvQi.js";import{m as U}from"./vendor-hSae87XV.js";const ee=ve();function p(e,...t){if(!ee)return;const r=ye(e,...t);performance.mark(r);try{console.log(e,...t)}catch{console.log(r)}}function Se(e,...t){ee&&console.warn(e,...t)}function ye(e,...t){return e.replace(/%[sfdO]/g,r=>{const s=t.shift();return r==="%O"&&s?JSON.stringify(s).replace(/"([^"]+)":/g,"$1:"):String(s)})}function ve(){try{if(typeof localStorage>"u")return!1;const t="nuqs-localStorage-test";localStorage.setItem(t,t);const r=localStorage.getItem(t)===t;if(localStorage.removeItem(t),!r)return!1}catch(t){return console.error("[nuqs]: debug mode is disabled (localStorage unavailable).",t),!1}return(localStorage.getItem("debug")??"").includes("nuqs")}const we={303:"Multiple adapter contexts detected. This might happen in monorepos.",404:"nuqs requires an adapter to work with your framework.",409:"Multiple versions of the library are loaded. This may lead to unexpected behavior. Currently using `%s`, but `%s` (via the %s adapter) was about to load on top.",414:"Max safe URL length exceeded. Some browsers may not be able to accept this URL. Consider limiting the amount of state stored in the URL.",429:"URL update rate-limited by the browser. Consider increasing `throttleMs` for key(s) `%s`. %O",500:"Empty search params cache. Search params can't be accessed in Layouts.",501:"Search params cache already populated. Have you called `parse` twice?"};function $(e){return`[nuqs] ${we[e]}
  See https://err.47ng.com/NUQS-${e}`}function Re(e){if(e.size===0)return"";const t=[];for(const[s,o]of e.entries()){const n=s.replace(/#/g,"%23").replace(/&/g,"%26").replace(/\+/g,"%2B").replace(/=/g,"%3D").replace(/\?/g,"%3F");t.push(`${n}=${Me(o)}`)}return"?"+t.join("&")}function Me(e){return e.replace(/%/g,"%25").replace(/\+/g,"%2B").replace(/ /g,"+").replace(/#/g,"%23").replace(/&/g,"%26").replace(/"/g,"%22").replace(/'/g,"%27").replace(/`/g,"%60").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/[\x00-\x1F]/g,t=>encodeURIComponent(t))}const _=g.createContext({useAdapter(){throw new Error($(404))}});_.displayName="NuqsAdapterContext";ee&&typeof window<"u"&&(window.__NuqsAdapterContext&&window.__NuqsAdapterContext!==_&&console.error($(303)),window.__NuqsAdapterContext=_);function Oe(e){return({children:t,...r})=>g.createElement(_.Provider,{...r,value:{useAdapter:e}},t)}function he(){const e=g.useContext(_);if(!("useAdapter"in e))throw new Error($(404));return e.useAdapter()}function je(){var t;if(typeof window>"u"||!!!window.GestureEvent)return 50;try{const r=(t=navigator.userAgent)==null?void 0:t.match(/version\/([\d\.]+) safari/i);return parseFloat(r[1])>=17?120:320}catch{return 320}}function Qe(e){return{method:"throttle",timeMs:e}}const L=Qe(je());function Y(e,t,r){function s(){e(),r.removeEventListener("abort",n)}const o=setTimeout(s,t);function n(){clearTimeout(o),r.removeEventListener("abort",n)}r.addEventListener("abort",n)}function Z(){const e=Promise;if("withResolvers"in Promise)return Promise.withResolvers();let t=()=>{},r=()=>{};return{promise:new e((o,n)=>{t=o,r=n}),resolve:t,reject:r}}function Ne(e,t){const r=s=>{if(s===e.length)return t();const o=e[s];if(!o)throw new Error("Invalid transition function");o(()=>r(s+1))};r(0)}function fe(){return new URLSearchParams(location.search)}var de=class{constructor(){O(this,"updateMap",new Map);O(this,"options",{history:"replace",scroll:!1,shallow:!0});O(this,"timeMs",L.timeMs);O(this,"transitions",new Set);O(this,"resolvers",null);O(this,"controller",new AbortController);O(this,"lastFlushedAt",0)}push({key:e,query:t,options:r},s=L.timeMs){p("[nuqs gtq] Enqueueing %s=%s %O",e,t,r),this.updateMap.set(e,t),r.history==="push"&&(this.options.history="push"),r.scroll&&(this.options.scroll=!0),r.shallow===!1&&(this.options.shallow=!1),r.startTransition&&this.transitions.add(r.startTransition),this.timeMs=Math.max(s,Number.isFinite(this.timeMs)?this.timeMs:0)}getQueuedQuery(e){return this.updateMap.get(e)}flush({getSearchParamsSnapshot:e=fe,rateLimitFactor:t=1,...r}){if(!Number.isFinite(this.timeMs))return p("[nuqs gtq] Skipping flush due to throttleMs=Infinity"),Promise.resolve(e());if(this.resolvers)return this.resolvers.promise;this.resolvers=Z();const s=()=>{this.lastFlushedAt=performance.now();const[n,a]=this.applyPendingUpdates({...r,autoResetQueueOnUpdate:r.autoResetQueueOnUpdate??!0,getSearchParamsSnapshot:e});a===null?this.resolvers.resolve(n):this.resolvers.reject(n),this.resolvers=null};return Y(()=>{const a=performance.now()-this.lastFlushedAt,i=this.timeMs,c=t*Math.max(0,Math.min(i,i-a));p("[nuqs gtq] Scheduling flush in %f ms. Throttled at %f ms (x%f)",c,i,t),c===0?s():Y(s,c,this.controller.signal)},0,this.controller.signal),this.resolvers.promise}abort(){var e;return this.controller.abort(),this.controller=new AbortController,(e=this.resolvers)==null||e.resolve(new URLSearchParams),this.resolvers=null,this.reset()}reset(){const e=Array.from(this.updateMap.keys());return p("[nuqs gtq] Resetting queue %s",JSON.stringify(Object.fromEntries(this.updateMap))),this.updateMap.clear(),this.transitions.clear(),this.options.history="replace",this.options.scroll=!1,this.options.shallow=!0,this.timeMs=L.timeMs,e}applyPendingUpdates(e){const{updateUrl:t,getSearchParamsSnapshot:r}=e,s=r();if(p("[nuqs gtq] Applying %d pending update(s) on top of %s",this.updateMap.size,s.toString()),this.updateMap.size===0)return[s,null];const o=Array.from(this.updateMap.entries()),n={...this.options},a=Array.from(this.transitions);e.autoResetQueueOnUpdate&&this.reset(),p("[nuqs gtq] Flushing queue %O with options %O",o,n);for(const[i,c]of o)c===null?s.delete(i):s.set(i,c);try{return Ne(a,()=>{t(s,{history:n.history,scroll:n.scroll,shallow:n.shallow})}),[s,null]}catch(i){return console.error($(429),o.map(([c])=>c).join(),i),[s,i]}}};const D=new de;function Ae(e,t,r){const s=g.useCallback(()=>{const a=Object.fromEntries(e.map(c=>[c,r(c)]));return[JSON.stringify(a),a]},[e.join(","),r]),o=g.useRef(null);o.current===null&&(o.current=s());const n=g.useCallback(a=>{const i=e.map(c=>t(c,a));return()=>i.forEach(c=>c())},[e.join(","),t]);return g.useSyncExternalStore(n,()=>{const[a,i]=s();return o.current[0]===a?o.current[1]:(o.current=[a,i],i)},()=>o.current[1])}var Ee=class{constructor(e){O(this,"callback");O(this,"resolvers",Z());O(this,"controller",new AbortController);O(this,"queuedValue");this.callback=e}abort(){this.controller.abort(),this.queuedValue=void 0}push(e,t){return this.queuedValue=e,this.controller.abort(),this.controller=new AbortController,Y(()=>{const r=this.resolvers;try{p("[nuqs dq] Flushing debounce queue",e);const s=this.callback(e);p("[nuqs dq] Reset debounced queue %O",this.queuedValue),this.queuedValue=void 0,this.resolvers=Z(),s.then(o=>r.resolve(o)).catch(o=>r.reject(o))}catch(s){this.queuedValue=void 0,r.reject(s)}},t,this.controller.signal),this.resolvers.promise}},Pe=class{constructor(e=new de){O(this,"throttleQueue");O(this,"queues",new Map);O(this,"queuedQuerySync",U());this.throttleQueue=e}useQueuedQueries(e){return Ae(e,(t,r)=>(this.queuedQuerySync.on(t,r),()=>this.queuedQuerySync.off(t,r)),t=>this.getQueuedQuery(t))}push(e,t,r){if(!Number.isFinite(t)){const n=r.getSearchParamsSnapshot??fe;return Promise.resolve(n())}if(!this.queues.has(e.key)){p("[nuqs dqc] Creating debounced queue for `%s`",e.key);const n=new Ee(a=>(this.throttleQueue.push(a),this.throttleQueue.flush(r).finally(()=>{var c;((c=this.queues.get(a.key))==null?void 0:c.queuedValue)===void 0&&(p("[nuqs dqc] Cleaning up empty queue for `%s`",a.key),this.queues.delete(a.key)),this.queuedQuerySync.emit(a.key)})));this.queues.set(e.key,n)}p("[nuqs dqc] Enqueueing debounced update %s=%s %O",e.key,e.query,e.options);const o=this.queues.get(e.key).push(e,t);return this.queuedQuerySync.emit(e.key),o}abort(e){var r;const t=this.queues.get(e);return t?(p("[nuqs dqc] Aborting debounced queue %s=%s",e,(r=t.queuedValue)==null?void 0:r.query),this.queues.delete(e),t.abort(),this.queuedQuerySync.emit(e),function(o){return o.then(n=>t.resolvers.resolve(n),n=>t.resolvers.reject(n)),o}):s=>s}abortAll(){var e;for(const[t,r]of this.queues.entries())p("[nuqs dqc] Aborting debounced queue %s=%s",t,(e=r.queuedValue)==null?void 0:e.query),r.abort(),r.resolvers.resolve(new URLSearchParams),this.queuedQuerySync.emit(t);this.queues.clear()}getQueuedQuery(e){var r,s;const t=(s=(r=this.queues.get(e))==null?void 0:r.queuedValue)==null?void 0:s.query;return t!==void 0?t:this.throttleQueue.getQueuedQuery(e)}};const x=new Pe(D);function H(e,t,r){try{return e(t)}catch(s){return Se("[nuqs] Error while parsing value `%s`: %O"+(r?" (for key `%s`)":""),t,s,r),null}}function Q(e){function t(r){if(typeof r>"u")return null;let s="";if(Array.isArray(r)){if(r[0]===void 0)return null;s=r[0]}return typeof r=="string"&&(s=r),H(e.parse,s)}return{eq:(r,s)=>r===s,...e,parseServerSide:t,withDefault(r){return{...this,defaultValue:r,parseServerSide(s){return t(s)??r}}},withOptions(r){return{...this,...r}}}}Q({parse:e=>e,serialize:e=>`${e}`});const ie=Q({parse:e=>{const t=parseInt(e);return Number.isNaN(t)?null:t},serialize:e=>Math.round(e).toFixed()});Q({parse:e=>{const t=ie.parse(e);return t===null?null:t-1},serialize:e=>ie.serialize(e+1)});Q({parse:e=>{const t=parseInt(e,16);return Number.isNaN(t)?null:t},serialize:e=>{const t=Math.round(e).toString(16);return t.padStart(t.length+t.length%2,"0")}});Q({parse:e=>{const t=parseFloat(e);return Number.isNaN(t)?null:t},serialize:e=>e.toString()});Q({parse:e=>e==="true",serialize:e=>e?"true":"false"});function te(e,t){return e.valueOf()===t.valueOf()}Q({parse:e=>{const t=parseInt(e);return Number.isNaN(t)?null:new Date(t)},serialize:e=>e.valueOf().toString(),eq:te});Q({parse:e=>{const t=new Date(e);return Number.isNaN(t.valueOf())?null:t},serialize:e=>e.toISOString(),eq:te});Q({parse:e=>{const t=new Date(e.slice(0,10));return Number.isNaN(t.valueOf())?null:t},serialize:e=>e.toISOString().slice(0,10),eq:te});const z=U();function He(e,{history:t="replace",shallow:r=!0,scroll:s=!1,throttleMs:o=L.timeMs,limitUrlUpdates:n,parse:a=d=>d,serialize:i=String,eq:c=(d,h)=>d===h,defaultValue:l=void 0,clearOnDefault:q=!0,startTransition:b}={history:"replace",scroll:!1,shallow:!0,throttleMs:L.timeMs,parse:d=>d,serialize:String,eq:(d,h)=>d===h,clearOnDefault:!0,defaultValue:void 0}){const d=g.useId(),h=he(),{[e]:y}=x.useQueuedQueries([e]),m=h.searchParams,j=g.useRef((m==null?void 0:m.get(e))??null),[N,F]=g.useState(()=>{const M=y===void 0?(m==null?void 0:m.get(e))??null:y;return M===null?null:H(a,M,e)}),v=g.useRef(N);p("[nuqs %s `%s`] render - state: %O, iSP: %s",d,e,N,(m==null?void 0:m.get(e))??null),g.useEffect(()=>{const M=y===void 0?(m==null?void 0:m.get(e))??null:y;if(M===j.current)return;const u=M===null?null:H(a,M,e);p("[nuqs %s `%s`] syncFromUseSearchParams %O",d,e,u),v.current=u,j.current=M,F(u)},[e,m==null?void 0:m.get(e),y]),g.useEffect(()=>{function M({state:u,query:f}){p("[nuqs %s `%s`] updateInternalState %O",d,e,u),v.current=u,j.current=f,F(u)}return p("[nuqs %s `%s`] subscribing to sync",d,e),z.on(e,M),()=>{p("[nuqs %s `%s`] unsubscribing from sync",d,e),z.off(e,M)}},[e]);const G=g.useCallback((M,u={})=>{var A,I,E;let f=Ce(M)?M(v.current??l??null):M;(u.clearOnDefault??q)&&f!==null&&l!==void 0&&c(f,l)&&(f=null);const S=f===null?null:i(f);z.emit(e,{state:f,query:S});const w={key:e,query:S,options:{history:u.history??t,shallow:u.shallow??r,scroll:u.scroll??s,startTransition:u.startTransition??b}};if(((A=u.limitUrlUpdates)==null?void 0:A.method)==="debounce"||(n==null?void 0:n.method)==="debounce"){const P=((I=u.limitUrlUpdates)==null?void 0:I.timeMs)??(n==null?void 0:n.timeMs)??L.timeMs;return x.push(w,P,h)}else{const P=((E=u.limitUrlUpdates)==null?void 0:E.timeMs)??(n==null?void 0:n.timeMs)??u.throttleMs??o,B=x.abort(e);return D.push(w,P),B(D.flush(h))}},[e,t,r,s,o,n==null?void 0:n.method,n==null?void 0:n.timeMs,b,h.updateUrl,h.getSearchParamsSnapshot,h.rateLimitFactor]);return[N??l??null,G]}function Ce(e){return typeof e=="function"}const Le={};function Ge(e,{history:t="replace",scroll:r=!1,shallow:s=!0,throttleMs:o=L.timeMs,limitUrlUpdates:n,clearOnDefault:a=!0,startTransition:i,urlKeys:c=Le}={}){const l=g.useId(),q=Object.keys(e).join(","),b=g.useMemo(()=>Object.fromEntries(Object.keys(e).map(u=>[u,c[u]??u])),[q,JSON.stringify(c)]),d=he(),h=d.searchParams,y=g.useRef({}),m=g.useMemo(()=>Object.fromEntries(Object.keys(e).map(u=>[u,e[u].defaultValue??null])),[Object.values(e).map(({defaultValue:u})=>u).join(",")]),j=x.useQueuedQueries(Object.values(b)),[N,F]=g.useState(()=>{const u=h??new URLSearchParams;return X(e,c,u,j).state}),v=g.useRef(N);if(p("[nuq+ %s `%s`] render - state: %O, iSP: %s",l,q,N,h),Object.keys(y.current).join("&")!==Object.values(b).join("&")){const{state:u,hasChanged:f}=X(e,c,h,j,y.current,v.current);f&&(p("[nuq+ %s `%s`] State changed: %O",l,q,{state:u,initialSearchParams:h,queuedQueries:j,queryRef:y.current,stateRef:v.current}),v.current=u,F(u)),y.current=Object.fromEntries(Object.values(b).map(S=>[S,(h==null?void 0:h.get(S))??null]))}g.useEffect(()=>{const{state:u,hasChanged:f}=X(e,c,h,j,y.current,v.current);f&&(p("[nuq+ %s `%s`] State changed: %O",l,q,{state:u,initialSearchParams:h,queuedQueries:j,queryRef:y.current,stateRef:v.current}),v.current=u,F(u))},[Object.values(b).map(u=>`${u}=${h==null?void 0:h.get(u)}`).join("&"),JSON.stringify(j)]),g.useEffect(()=>{function u(S){p("[nuq+ %s `%s`] updateInternalState %O",l,q,S),v.current=S,F(S)}const f=Object.keys(e).reduce((S,w)=>(S[w]=({state:A,query:I})=>{const{defaultValue:E}=e[w],P=b[w];v.current={...v.current,[w]:A??E??null},y.current[P]=I,p("[nuq+ %s `%s`] Cross-hook key sync %s: %O (default: %O). Resolved: %O",l,q,P,A,E,v.current),u(v.current)},S),{});for(const S of Object.keys(e)){const w=b[S];p("[nuq+ %s `%s`] Subscribing to sync for `%s`",l,w,q),z.on(w,f[S])}return()=>{for(const S of Object.keys(e)){const w=b[S];p("[nuq+ %s `%s`] Unsubscribing to sync for `%s`",l,w,q),z.off(w,f[S])}}},[q,b]);const G=g.useCallback((u,f={})=>{var B,re,se,ne,ue,oe;const S=Object.fromEntries(Object.keys(e).map(V=>[V,null])),w=typeof u=="function"?u(le(v.current,m))??S:u??S;p("[nuq+ %s `%s`] setState: %O",l,q,w);let A,I=0;const E=[];for(let[V,C]of Object.entries(w)){const R=e[V],W=b[V];if(!R)continue;(f.clearOnDefault??R.clearOnDefault??a)&&C!==null&&R.defaultValue!==void 0&&(R.eq??((T,K)=>T===K))(C,R.defaultValue)&&(C=null);const ce=C===null?null:(R.serialize??String)(C);z.emit(W,{state:C,query:ce});const ae={key:W,query:ce,options:{history:f.history??R.history??t,shallow:f.shallow??R.shallow??s,scroll:f.scroll??R.scroll??r,startTransition:f.startTransition??R.startTransition??i}};if(((B=f==null?void 0:f.limitUrlUpdates)==null?void 0:B.method)==="debounce"||(n==null?void 0:n.method)==="debounce"||((re=R.limitUrlUpdates)==null?void 0:re.method)==="debounce"){const T=((se=f==null?void 0:f.limitUrlUpdates)==null?void 0:se.timeMs)??(n==null?void 0:n.timeMs)??((ne=R.limitUrlUpdates)==null?void 0:ne.timeMs)??L.timeMs,K=x.push(ae,T,d);I<T&&(A=K,I=T)}else{const T=((ue=f==null?void 0:f.limitUrlUpdates)==null?void 0:ue.timeMs)??((oe=R==null?void 0:R.limitUrlUpdates)==null?void 0:oe.timeMs)??(n==null?void 0:n.timeMs)??f.throttleMs??R.throttleMs??o;E.push(x.abort(W)),D.push(ae,T)}}const P=E.reduce((V,C)=>C(V),D.flush(d));return A??P},[q,t,s,r,o,n==null?void 0:n.method,n==null?void 0:n.timeMs,i,b,d.updateUrl,d.getSearchParamsSnapshot,d.rateLimitFactor,m]);return[g.useMemo(()=>le(N,m),[N,m]),G]}function X(e,t,r,s,o,n){let a=!1;const i=Object.keys(e).reduce((c,l)=>{const q=(t==null?void 0:t[l])??l,{parse:b}=e[l],d=s[q],h=d===void 0?(r==null?void 0:r.get(q))??null:d;if(o&&n&&(o[q]??null)===h)return c[l]=n[l]??null,c;a=!0;const y=h===null?null:H(b,h,l);return c[l]=y??null,o&&(o[q]=h),c},{});if(!a){const c=Object.keys(e),l=Object.keys(n??{});a=c.length!==l.length||c.some(q=>!l.includes(q))}return{state:i,hasChanged:a}}function le(e,t){return Object.fromEntries(Object.keys(e).map(r=>[r,e[r]??t[r]??null]))}let J=0;function xe(e=1){J=e}function Ie(){J=Math.max(0,J-1),!(J>0)&&ge()}function ge(){p("[nuqs] Aborting queues"),x.abortAll(),D.abort().forEach(t=>x.queuedQuerySync.emit(t))}const k="__nuqs__";function Te(e){if(e instanceof URL)return e.searchParams;if(e.startsWith("?"))return new URLSearchParams(e);try{return new URL(e,location.origin).searchParams}catch{return new URLSearchParams(e)}}function De(e){var t,r,s;return typeof history>"u"?!1:(t=history.nuqs)!=null&&t.version&&history.nuqs.version!=="0.0.0-inject-version-here"?(console.error($(409),history.nuqs.version,"0.0.0-inject-version-here",e),!1):!((s=(r=history.nuqs)==null?void 0:r.adapters)!=null&&s.includes(e))}function Fe(e){history.nuqs=history.nuqs??{version:"0.0.0-inject-version-here",adapters:[]},history.nuqs.adapters.push(e)}function Ve(e,t){if(!De(t))return;let r=typeof location=="object"?location.search:"";e.on("update",a=>{const i=a.toString();r=i.length?"?"+i:""}),window.addEventListener("popstate",()=>{r=location.search,ge()}),p("[nuqs %s] Patching history (%s adapter)","0.0.0-inject-version-here",t);function s(a){Ie();try{if(new URL(a,location.origin).search===r)return}catch{}try{e.emit("update",Te(a))}catch(i){console.error(i)}}const o=history.pushState,n=history.replaceState;history.pushState=function(i,c,l){o.call(history,i,"",l),l&&c!==k&&s(l)},history.replaceState=function(i,c,l){n.call(history,i,"",l),l&&c!==k&&s(l)},Fe(t)}function ze({adapter:e,useNavigate:t,useSearchParams:r}){const s=U(),o=e!=="react-router-v6";function n(){const i=g.useRef(!1);i.current&&(i.current=!1,D.reset());const c=t(),l=a(),q=g.useCallback((b,d)=>{var m;g.startTransition(()=>{s.emit("update",b)});const h=new URL(location.href);h.search=Re(b),p(`[nuqs ${e}] Updating url: %s`,h);const y=d.history==="push"?history.pushState:history.replaceState;xe(d.shallow?1:2),y.call(history,history.state,k,h),d.shallow===!1&&c({hash:h.hash,search:h.search},{replace:!0,preventScrollReset:!0,state:(m=history.state)==null?void 0:m.usr}),d.scroll&&window.scrollTo(0,0),i.current=o},[c]);return{searchParams:l,updateUrl:q,autoResetQueueOnUpdate:!1}}function a(){const[i]=r(typeof location>"u"?new URLSearchParams:new URLSearchParams(location.search)),[c,l]=g.useState(()=>typeof location>"u"?i:new URLSearchParams(location.search));return g.useEffect(()=>{function q(){l(new URLSearchParams(location.search))}function b(d){l(d)}return s.on("update",b),window.addEventListener("popstate",q),()=>{s.off("update",b),window.removeEventListener("popstate",q)}},[]),c}return Ve(s,e),{NuqsAdapter:Oe(n),useOptimisticSearchParams:a}}const _e=ze({adapter:"react-router-v7",useNavigate:me,useSearchParams:be}),We=_e.NuqsAdapter;export{We as N,Ge as a,Q as c,ie as p,He as u};
