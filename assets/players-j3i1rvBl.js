import{j as e,B as n,T as x,L as E,D as L,a as R,b as v}from"./mui-CXhE_iE7.js";import{a as $,s as p,R as u,t as _,r as D,i as m,h as B,T as F,S as A,u as k,p as w,b as C,E as S,L as P,c as U,H as N,F as G}from"./shared-NOuZrZ1c.js";import{a as K,L as Y,r as T}from"./react-Bs57X6Ch.js";import{u as H}from"./query-DeXAFL7x.js";import{u as j}from"./localization-BTb5j_W4.js";import{R as z,C as I,a as W,X,Y as q,T as O,L as Q,b as M,S as J}from"./charts-CZXdVTiO.js";import"./analytics-HyNrjKFN.js";import"./utils-BT3gc4jm.js";const V=({data:s})=>{const{getFederationUrl:h,getClubUrl:l,getCoachUrl:y}=$(),{t:c}=j();return e.jsxs(n,{display:"flex",sx:{flexDirection:{xs:"column",md:"row"},gap:4},children:[s.photo&&e.jsx(n,{display:"flex",justifyContent:"center",children:e.jsx(n,{component:"img",src:s.photo,alt:p(s),sx:{width:150,height:150,objectFit:"cover",borderRadius:"50%",boxShadow:2}})}),e.jsxs(n,{display:"flex",flexDirection:"column",flex:1,children:[s.id&&s.id>0&&e.jsxs(n,{display:"flex",children:[e.jsx(n,{flexBasis:"50%",children:e.jsxs(x,{variant:"body1",children:[c("fide"),":"]})}),e.jsx(n,{flexBasis:"50%",children:e.jsx(E,{href:`https://ratings.fide.com/profile/${s.id}`,variant:"body1",target:"_blank",rel:"noopener",children:s.id})})]}),s.yob&&e.jsxs(n,{display:"flex",children:[e.jsx(n,{flexBasis:"50%",children:e.jsxs(x,{variant:"body1",children:[c("year_of_birth"),":"]})}),e.jsxs(n,{display:"flex",flexBasis:"50%",gap:1,children:[e.jsx(x,{variant:"body1",children:s.yob}),e.jsx(x,{variant:"body1",color:"textSecondary",children:`(${new Date().getFullYear()-s.yob} ${c("years")})`})]})]}),s.fed&&e.jsxs(n,{display:"flex",children:[e.jsx(n,{flexBasis:"50%",children:e.jsxs(x,{variant:"body1",children:[c("federation"),":"]})}),e.jsxs(n,{display:"flex",flexBasis:"50%",gap:1,children:[e.jsx(u,{to:h(s.fed),children:c(`federation_enum_short.${s.fed}`)}),s.fed2&&e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"body1",color:"textSecondary",children:"/"}),e.jsx(x,{variant:"body1",color:"textSecondary",children:p(s.fed2)})]})]})]}),s.clubs&&s.clubs.length>0&&e.jsxs(n,{display:"flex",children:[e.jsx(n,{flexBasis:"50%",children:e.jsxs(x,{variant:"body1",children:[c("club",{count:s.clubs.length}),":"]})}),e.jsx(n,{flexBasis:"50%",display:"flex",flexDirection:"column",children:s.clubs.map((a,r)=>{const t=p(a);return a.id?e.jsx(n,{alignSelf:"flex-start",children:e.jsx(u,{to:l(Number(a.id)),children:t})},r):e.jsx(x,{variant:"body1",children:t},r)})})]}),s.coaches&&s.coaches.length>0&&e.jsxs(n,{display:"flex",children:[e.jsx(n,{flexBasis:"50%",children:e.jsxs(x,{variant:"body1",children:[c("coach",{count:s.coaches.length}),":"]})}),e.jsx(n,{flexBasis:"50%",display:"flex",flexDirection:"column",children:s.coaches.map((a,r)=>{const t=p(a);return a.id?e.jsx(n,{alignSelf:"flex-start",children:e.jsx(u,{to:y(Number(a.id)),children:t})},r):e.jsx(x,{variant:"body1",children:t},r)})})]})]})]})},b={[m.Classical]:"#4C72B0",[m.Rapid]:"#55A868",[m.Blitz]:"#C44E52"},Z=({results:s,yob:h})=>{const{t:l}=j(),y=s.filter((r,t,i)=>i.findIndex(d=>d.year===r.year&&d.game===r.game&&d.rank<=r.rank)===t).sort((r,t)=>r.year-t.year),c=({x:r,y:t,payload:i})=>{if(!i||i.value===void 0)return null;const d=i.value,o=d-(h??d);return e.jsxs("g",{transform:`translate(${r},${t})`,children:[e.jsx("text",{x:0,y:0,dy:10,textAnchor:"middle",fill:"#666",children:d}),o>0&&e.jsxs("text",{x:0,y:15,dy:10,textAnchor:"middle",fill:"#999",children:[o," ",l("years")]})]})},a=({active:r,payload:t,label:i})=>{if(!r||!t||t.length===0)return null;const d=i;return e.jsxs("div",{style:{backgroundColor:"white",padding:10,border:"1px solid #ccc",borderRadius:5},children:[d,s.filter(o=>o.year===d).sort((o,g)=>o.rank-g.rank||o.game-g.game||o.category-g.category).map((o,g)=>e.jsxs("div",{children:[o.rank,":"," ",e.jsxs("span",{style:{color:b[o.game]},children:[`${l(`type_enum_short.${o.type}`)} `,l(`game_enum_short.${o.game}`),o.category==B.All?"":` ${l(`category_enum_short.${o.category}`)}`]})]},g))]})};return e.jsx(n,{width:"100%",height:400,children:e.jsx(z,{width:"100%",height:"100%",children:e.jsxs(I,{margin:{top:10,right:10,left:10,bottom:10},children:[e.jsx(W,{strokeDasharray:"3 3"}),e.jsx(X,{type:"number",dataKey:"year",name:"Year",domain:[2014,D+1],padding:{left:20,right:20},height:40,ticks:[2014,2016,2018,2020,2022,2024,2026],tick:e.jsx(c,{})}),e.jsx(q,{type:"number",dataKey:"rank",name:"Rank",domain:[1,5],reversed:!0,padding:{top:20,bottom:20},width:10}),e.jsx(O,{content:a}),e.jsx(Q,{}),_.getEnums(m).map((r,t)=>e.jsx(M,{name:l(`game_enum_short.${r}`),type:"monotone",data:y.filter(i=>i.game===r),dataKey:"rank",stroke:b[r],strokeWidth:2,dot:{r:8}},`line-${t}`)),_.getEnums(m).map((r,t)=>e.jsx(J,{name:l(`game_enum_short.${r}`),data:s.filter(i=>i.game===r).map(i=>({year:i.year,rank:i.rank})),fill:b[r],legendType:"none"},`game_scatter-${t}`))]})})})},ee=({results:s,yob:h})=>{const{t:l}=j(),{getTournamentUrl:y}=$(),c=(a,r,t,i,d)=>{const o=l(`type_enum_short.${a}`),g=l(`game_enum_short.${i}`),f=l(`gender_category.${d}.${t}`);return f?`${o} ${r} ${g} - ${f}`:`${o} ${r} ${g}`};return e.jsx(e.Fragment,{children:[...new Set(s.map(a=>a.rank))].map(a=>e.jsxs(n,{display:"flex",padding:2,gap:1,border:"1px solid #ddd",boxShadow:"0px 4px 6px rgba(63, 81, 181, 0.3)",bgcolor:a===1?"#ffffff":a===2?"#fcfcfc":a===3?"#f7f7f7":a===4?"#ededed":a===5?"#e5e5e5":"transparent",children:[e.jsx(n,{flexGrow:"auto",children:e.jsxs(x,{variant:"body1",children:[a,"."]})}),e.jsx(n,{flex:1,children:s.filter(r=>r.rank===a).map((r,t,i)=>e.jsxs(K.Fragment,{children:[e.jsx(Y,{to:y(r.year,r.category,r.game,r.gender),style:{textDecoration:"none",color:"inherit"},children:e.jsxs(n,{display:"flex",flexDirection:"row",gap:1,sx:{"&:hover":{backgroundColor:"#f9f9f9"},borderRadius:"4px"},children:[e.jsx(n,{flexGrow:1,children:e.jsx(x,{variant:"body1",sx:{"&:hover":{textDecoration:"underline"}},color:r.type==F.UC?"textPrimary":"primary",children:c(r.type,r.year,r.category,r.game,r.gender)},"title")}),e.jsx(n,{children:e.jsx(x,{variant:"body1",color:"textSecondary",sx:{whiteSpace:"nowrap"},children:`${h?` ${r.year-h} ${l("years")}`:""}`},"year")})]})}),t<i.length-1&&e.jsx(L,{sx:{my:1}})]},t))})]},a))})},re="/",se={async get(s){const h=A.encode(s.toString()),l=await fetch(`${re}api/players/${h}.json?v=c4c0d9f`);if(!l.ok)throw new Error(`Failed to get player (id=${s}) data`);return await l.json()}},xe=()=>{const[s]=k("id",w),[h,l]=k("tab",w.withDefault(0)),{getPlayerUrl:y}=$(),{t:c,i18n:a}=j(),{data:r,isLoading:t,error:i}=H({queryKey:["players",{id:s}],queryFn:async()=>await se.get(s),enabled:!!s}),d=T.useMemo(()=>(a.resolvedLanguage==="uk"?r?.name_uk:r?.name_en)||r?.name_uk||r?.name_en||"",[r,a.resolvedLanguage]),o=T.useCallback((g,f)=>{l(f)},[l]);if(!s)return e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx(S,{message:"Player id is missing."})]});if(i)return e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx(S,{message:i.message})]});if(t)return e.jsx(P,{});if(r)return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:d,description:c("player_description"),url:y(s,!1)}),e.jsxs(n,{display:"flex",flexDirection:"column",padding:2,gap:1,boxSizing:"border-box",minHeight:"100vh",children:[e.jsx(N,{title:d}),e.jsx(V,{data:r}),e.jsxs(R,{value:h,onChange:o,children:[e.jsx(v,{label:c("results"),sx:{minWidth:0,paddingRight:0,paddingLeft:0,marginRight:1}}),e.jsx(v,{label:c("progress"),sx:{minWidth:0,paddingRight:0,paddingLeft:0}})]}),e.jsxs(n,{display:"flex",flexDirection:"column",flexGrow:1,gap:1,children:[h===0&&e.jsx(ee,{results:r.results,yob:r.yob}),h===1&&e.jsx(Z,{results:r.results,yob:r.yob})]}),e.jsx(G,{})]})]})};export{xe as PlayerPage};
